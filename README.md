# observation-system
本プログラムは，監視ログファイルを読み込み，故障状態のサーバアドレスとそのサーバの故障期間を出力するプログラムである。

## Description
プログラム実行のアウトラインを以下に記述する。
まず，CSVファイルを読み込み，アドレスをキー，そのレスポンス情報をバリューとする辞書型に変換する。
ここで，レスポンス情報は`utils.Response`クラスに従って格納される。
次に，その辞書の各アドレスについて，レスポンスの時系列順にエラー状態を管理する。
状態及びその管理に関しては，`utils.ErrorState`, `utils.ErrorStateManager`を参照する。
各問の仕様等を以下に示す。

### Q1
タイムアウトした場合を故障とみなし，最初にタイムアウトしたときから，次に応答が返るまでを故障期間とする。
ログファイルの末尾に到達した場合，期間の終了の出力の代わりとして文字列`'continue'`を出力する。
以降，ファイル末尾の処理は同様である。

### Q2
Q1において，`N`回以上連続してタイムアウトした場合にのみ故障とみなす。

### Q3
直近`m`回の平均応答時間が`t`ミリ秒を超えた場合，サーバが過負荷状態になっているとみなし，その期間を出力する。
`m`回のうちにタイムアウトが含まれる場合，過負荷状態であるとして処理する。

### Q4
あるサブネット内のサーバが全て故障（Q2の故障判定を参照する）している場合は，
そのサブネット（のスイッチ）の故障とみなし，その期間を出力する。

## Demo
テストデータ`data/log-sample.csv`に対して各プログラムを実行した結果を以下に示す。

### Q1
```
Address 10.20.30.1/16
Error[1] 2020-10-19 13:33:24 - 2020-10-19 13:34:24 (60.0[s])
Error[2] 2020-10-19 13:36:24 - 2020-10-19 13:37:24 (60.0[s])
Error[3] 2020-10-19 13:38:24 - 2020-10-19 13:39:24 (60.0[s])
Error[4] 2020-10-19 13:40:24 - 2020-10-19 13:41:24 (60.0[s])
Error[5] 2020-10-19 13:42:24 - 2020-10-19 13:45:24 (180.0[s])
Error[6] 2020-10-19 13:46:24 - 2020-10-19 13:49:24 (180.0[s])
Error[7] 2020-10-19 13:50:24 - 2020-10-19 13:51:24 (60.0[s])
Error[8] 2020-10-19 13:53:24 - 2020-10-19 13:55:24 (120.0[s])
Error[9] 2020-10-19 13:56:24 - 2020-10-19 13:57:24 (60.0[s])
Error[10] 2020-10-19 13:58:24 - 2020-10-19 14:04:24 (360.0[s])
Error[11] 2020-10-19 14:05:24 - 2020-10-19 14:13:24 (480.0[s])
Error[12] 2020-10-19 14:14:24 - 2020-10-19 14:16:24 (120.0[s])
Error[13] 2020-10-19 14:17:24 - 2020-10-19 14:18:24 (60.0[s])
Error[14] 2020-10-19 14:19:24 - continue
14 error(s)
Address 10.20.30.2/16
Error[1] 2020-10-19 13:36:25 - 2020-10-19 13:40:25 (240.0[s])
Error[2] 2020-10-19 13:41:25 - 2020-10-19 13:43:25 (120.0[s])
Error[3] 2020-10-19 13:44:25 - 2020-10-19 13:46:25 (120.0[s])
Error[4] 2020-10-19 13:47:25 - 2020-10-19 13:48:25 (60.0[s])
Error[5] 2020-10-19 13:54:25 - 2020-10-19 13:57:25 (180.0[s])
Error[6] 2020-10-19 13:58:25 - 2020-10-19 14:00:25 (120.0[s])
Error[7] 2020-10-19 14:01:25 - 2020-10-19 14:02:25 (60.0[s])
Error[8] 2020-10-19 14:03:25 - 2020-10-19 14:04:25 (60.0[s])
Error[9] 2020-10-19 14:06:25 - 2020-10-19 14:07:25 (60.0[s])
Error[10] 2020-10-19 14:09:25 - 2020-10-19 14:10:25 (60.0[s])
Error[11] 2020-10-19 14:12:25 - 2020-10-19 14:18:25 (360.0[s])
Error[12] 2020-10-19 14:19:25 - continue
12 error(s)
Address 192.168.1.1/24
Error[1] 2020-10-19 13:32:34 - 2020-10-19 13:35:34 (180.0[s])
Error[2] 2020-10-19 13:38:34 - 2020-10-19 13:39:34 (60.0[s])
Error[3] 2020-10-19 13:40:34 - 2020-10-19 13:41:34 (60.0[s])
Error[4] 2020-10-19 13:43:34 - 2020-10-19 13:45:34 (120.0[s])
Error[5] 2020-10-19 13:47:34 - 2020-10-19 13:48:34 (60.0[s])
Error[6] 2020-10-19 13:49:34 - 2020-10-19 13:50:34 (60.0[s])
Error[7] 2020-10-19 13:52:34 - 2020-10-19 13:55:34 (180.0[s])
Error[8] 2020-10-19 13:56:34 - 2020-10-19 13:58:34 (120.0[s])
Error[9] 2020-10-19 14:00:34 - 2020-10-19 14:01:34 (60.0[s])
Error[10] 2020-10-19 14:02:34 - 2020-10-19 14:05:34 (180.0[s])
Error[11] 2020-10-19 14:06:34 - 2020-10-19 14:16:34 (600.0[s])
Error[12] 2020-10-19 14:17:34 - 2020-10-19 14:18:34 (60.0[s])
Error[13] 2020-10-19 14:19:34 - 2020-10-19 14:21:34 (120.0[s])
13 error(s)
Address 192.168.1.2/24
Error[1] 2020-10-19 13:32:35 - 2020-10-19 13:34:35 (120.0[s])
Error[2] 2020-10-19 13:35:35 - 2020-10-19 13:36:35 (60.0[s])
Error[3] 2020-10-19 13:39:35 - 2020-10-19 13:44:35 (300.0[s])
Error[4] 2020-10-19 13:45:35 - 2020-10-19 13:46:35 (60.0[s])
Error[5] 2020-10-19 13:47:35 - 2020-10-19 13:48:35 (60.0[s])
Error[6] 2020-10-19 13:50:35 - 2020-10-19 13:51:35 (60.0[s])
Error[7] 2020-10-19 13:52:35 - 2020-10-19 13:53:35 (60.0[s])
Error[8] 2020-10-19 13:54:35 - 2020-10-19 13:55:35 (60.0[s])
Error[9] 2020-10-19 14:00:35 - 2020-10-19 14:03:35 (180.0[s])
Error[10] 2020-10-19 14:06:35 - 2020-10-19 14:12:35 (360.0[s])
Error[11] 2020-10-19 14:14:35 - 2020-10-19 14:15:35 (60.0[s])
Error[12] 2020-10-19 14:17:35 - 2020-10-19 14:20:35 (180.0[s])
12 error(s)
```

### Q2
Parameters: `N = 3`
```
Address 10.20.30.1/16
Error[1] 2020-10-19 13:58:24 - 2020-10-19 14:04:24 (360.0[s])
Error[2] 2020-10-19 14:05:24 - 2020-10-19 14:13:24 (480.0[s])
Error[3] 2020-10-19 14:19:24 - continue
3 error(s)
Address 10.20.30.2/16
Error[1] 2020-10-19 13:36:25 - 2020-10-19 13:40:25 (240.0[s])
Error[2] 2020-10-19 14:12:25 - 2020-10-19 14:18:25 (360.0[s])
Error[3] 2020-10-19 14:19:25 - continue
3 error(s)
Address 192.168.1.1/24
Error[1] 2020-10-19 14:06:34 - 2020-10-19 14:16:34 (600.0[s])
1 error(s)
Address 192.168.1.2/24
Error[1] 2020-10-19 13:39:35 - 2020-10-19 13:44:35 (300.0[s])
Error[2] 2020-10-19 14:06:35 - 2020-10-19 14:12:35 (360.0[s])
2 error(s)
```

### Q3
Parameters: `m = 2`, `t = 250`
```
Server Address 10.20.30.1/16
Overload[1] 2020-10-19 13:33:24 - 2020-10-19 13:35:24 (120.0[s])
Overload[2] 2020-10-19 13:36:24 - 2020-10-19 13:52:24 (960.0[s])
Overload[3] 2020-10-19 13:53:24 - continue
3 error(s)
Server Address 10.20.30.2/16
Overload[1] 2020-10-19 13:36:25 - 2020-10-19 13:51:25 (900.0[s])
Overload[2] 2020-10-19 13:54:25 - 2020-10-19 14:05:25 (660.0[s])
Overload[3] 2020-10-19 14:06:25 - 2020-10-19 14:08:25 (120.0[s])
Overload[4] 2020-10-19 14:09:25 - 2020-10-19 14:11:25 (120.0[s])
Overload[5] 2020-10-19 14:12:25 - continue
5 error(s)
Server Address 192.168.1.1/24
Overload[1] 2020-10-19 13:32:34 - 2020-10-19 13:36:34 (240.0[s])
Overload[2] 2020-10-19 13:38:34 - 2020-10-19 13:42:34 (240.0[s])
Overload[3] 2020-10-19 13:43:34 - 2020-10-19 13:46:34 (180.0[s])
Overload[4] 2020-10-19 13:47:34 - 2020-10-19 13:51:34 (240.0[s])
Overload[5] 2020-10-19 13:52:34 - 2020-10-19 13:59:34 (420.0[s])
Overload[6] 2020-10-19 14:00:34 - continue
6 error(s)
Server Address 192.168.1.2/24
Overload[1] 2020-10-19 13:32:35 - 2020-10-19 13:37:35 (300.0[s])
Overload[2] 2020-10-19 13:39:35 - 2020-10-19 13:49:35 (600.0[s])
Overload[3] 2020-10-19 13:50:35 - 2020-10-19 13:56:35 (360.0[s])
Overload[4] 2020-10-19 13:59:35 - 2020-10-19 14:04:35 (300.0[s])
Overload[5] 2020-10-19 14:06:35 - 2020-10-19 14:13:35 (420.0[s])
Overload[6] 2020-10-19 14:14:35 - 2020-10-19 14:16:35 (120.0[s])
Overload[7] 2020-10-19 14:17:35 - 2020-10-19 14:21:35 (240.0[s])
7 error(s)
```

### Q4
Parameters: `N = 3`
```
Subnet Address 10.20.0.0/16
Network Address 10.20.30.1/16 3 error(s)
Network Address 10.20.30.2/16 3 error(s)
Error[1] 2020-10-19 13:36:25 - 2020-10-19 13:40:25 (240.0[s])
Error[2] 2020-10-19 14:12:25 - 2020-10-19 14:18:25 (360.0[s])
Error[3] 2020-10-19 14:19:25 - continue
3 error(s)
Subnet Address 192.168.1.0/24
Network Address 192.168.1.1/24 1 error(s)
Network Address 192.168.1.2/24 2 error(s)
Error[1] 2020-10-19 13:39:35 - 2020-10-19 13:44:35 (300.0[s])
Error[2] 2020-10-19 14:06:35 - 2020-10-19 14:12:35 (360.0[s])
2 error(s)
```

## Usage

### Q1
```
$ python q1.py ./data/log-sample.csv
```
Argument 1: ログファイルのパス

### Q2
```
$ python q2.py ./data/log-sample.csv 3
```
Argument 1: ログファイルのパス，
Argument 2: 故障とみなす連続タイムアウトの回数

### Q3
```
$ python q3.py ./data/log-sample.csv 2 250
```
Argument 1: ログファイルのパス，
Argument 2: 参照する直近の応答の数，
Argument 3: 過負荷とみなす平均応答時間

### Q4
```
$ python q4.py ./data/log-sample.csv 3
```
Argument 1: ログファイルのパス，
Argument 2: 故障とみなす連続タイムアウトの回数

## Requirement
+ Python 3.8

## Author
[Yuta Katoh](https://github.com/yukatoh)
